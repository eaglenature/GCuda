#################################################################################################
#  Build script for xtests
#################################################################################################

NVCC = "$(shell which nvcc)"

#------------------------------------------------------------------------------------------------
#  Target architecture
#------------------------------------------------------------------------------------------------

DEVICE_ARCH_SM35 = -gencode=arch=compute_35,code=\"sm_35,compute_35\"
DEVICE_ARCH_SM30 = -gencode=arch=compute_30,code=\"sm_30,compute_30\"
DEVICE_ARCH_SM21 = -gencode=arch=compute_20,code=\"sm_21,compute_20\"
DEVICE_ARCH_SM20 = -gencode=arch=compute_20,code=\"sm_20,compute_20\"
DEVICE_ARCH_SM13 = -gencode=arch=compute_13,code=\"sm_13,compute_13\"
DEVICE_ARCH_SM11 = -gencode=arch=compute_11,code=\"sm_11,compute_11\"
DEVICE_ARCH_SM10 = -gencode=arch=compute_10,code=\"sm_10,compute_10\"

DEVICE_ARCH = $(DEVICE_ARCH_SM21)

#------------------------------------------------------------------------------------------------
#  Includes
#------------------------------------------------------------------------------------------------

INC = -I. -I../gcuda

#------------------------------------------------------------------------------------------------
#  Libraries
#------------------------------------------------------------------------------------------------

LIB = -lgtest -lgmock

#------------------------------------------------------------------------------------------------
#  Defines
#------------------------------------------------------------------------------------------------

DEFINES =

#------------------------------------------------------------------------------------------------
#  Compiler flags
#------------------------------------------------------------------------------------------------

HOST_ARCH = 

NVCCFLAGS = -Xptxas -v -Xcudafe -\#

#------------------------------------------------------------------------------------------------
#  Dependency list
#------------------------------------------------------------------------------------------------

DEPS =

#------------------------------------------------------------------------------------------------
#  make all
#------------------------------------------------------------------------------------------------

all:
	make main

#------------------------------------------------------------------------------------------------
#  make clean
#------------------------------------------------------------------------------------------------

clean:
	rm -f bin/*
	rm -f *.i* *.cubin *.ptx *.o

#------------------------------------------------------------------------------------------------
#  make main
#------------------------------------------------------------------------------------------------

main: bin/main

bin/main : main.cu $(DEPS)
	mkdir -p bin
	$(NVCC) $(DEFINES) $(DEVICE_ARCH) -o bin/main main.cu $(NVCCFLAGS) $(HOST_ARCH) $(INC) $(LIB) -O3

